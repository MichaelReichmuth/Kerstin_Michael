filter(on_velostrasse == TRUE &
typ != "Parkierunfall") %>%
mutate(date_reference = as.Date(paste0(year, "-", month, "-01")),
ym = as.yearmon(date_reference)) %>%
left_join(average_zaehlung, by = "ym") %>%
mutate(diff = ym_accident - ym,
diff_months = round((ym_accident - ym) * 12))
unfaelle_clean_velostrasse_relative <- unfaelle_clean %>%
filter(on_velostrasse == TRUE &
typ != "Parkierunfall") %>%
mutate(date_reference = as.Date(paste0(year, "-", month, "-01")),
ym = as.yearmon(date_reference)) %>%
left_join(average_zaehlung, by = "ym") %>%
mutate(diff = ym_accident - ym,
diff_months = round((ym_accident - ym) * 12))
x <- 1 # choose size of bins
unfaelle_clean_velostrasse_grouped <- unfaelle_clean_velostrasse_relative %>%
filter(diff_months >= -60 & diff_months <= 24) %>%
mutate(diff_months_group = floor(diff_months / x) * x) %>%
group_by(diff_months_group) %>%
summarise(
count = n(),
relative_count = count / mean(mean_average, na.rm = TRUE),
.groups = "drop"
)
full_months <- tibble(diff_months_group = seq(-60, 24, by = x))
unfaelle_prep <- full_months %>%
left_join(unfaelle_clean_velostrasse_grouped, by = "diff_months_group") %>%
mutate(count = replace_na(count, 0),
relative_count = replace_na(relative_count, 0)) %>%
mutate(after_transition = diff_months_group > 0,
before_transition = diff_months_group < 0)
p <- ggplot(unfaelle_prep, aes(diff_months_group, relative_count)) +
geom_point() +
geom_smooth(data = subset(unfaelle_prep, after_transition == TRUE),
aes(diff_months_group, relative_count), method = "lm") +
geom_smooth(data = subset(unfaelle_prep, before_transition == TRUE),
aes(diff_months_group, relative_count), method = "lm") +
geom_vline(xintercept = 0, color = "red", linetype = 1, size = 0.5) +
geom_text(aes(x = 4, y = 0.08, label = "Velostreet transition"),
vjust = 0, hjust = 1.3, color = "red", size = 4) +
scale_x_continuous(breaks = seq(
floor(min(unfaelle_clean_velostrasse$diff_months) / 12) * 12,
ceiling(max(unfaelle_clean_velostrasse$diff_months) / 12) * 12,
by = 12
)
) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
ggtitle("Accident rate across all velostrassen (before and after transition)") +
xlab("Months relative to velostreet transition") +
ylab("Accident rate relative to cyclist volume") +
theme_minimal()
print(p)
ggsave("Plot_6.jpeg", plot = p, width = 12, height = 8, dpi = 600)
unfaelle_clean_velostrasse_absolute <- unfaelle_clean_velostrasse_relative %>%
filter(diff_months >= -60 & diff_months <= 24) %>%
mutate(diff_months_group = floor(diff_months / x) * x) %>%
mutate(after_transition = diff_months_group > 0,
before_transition = diff_months_group < 0) %>%
pivot_longer(cols = c(before_transition, after_transition),
names_to = 'before_after',
values_to = "T_F") %>%
subset(T_F == TRUE) %>%
mutate(before_after = factor(before_after, levels = c("before_transition", "after_transition")))
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, color = typ)) +
geom_col()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill")
library(viridis)
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "A") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "B") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "E") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("Before/After") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("Before/After") +
ggtitle("Proportional Distribution of 'typ' (before and after transition)") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ' (before and after transition)") +
theme_minimal()
unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "F") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "G") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "H") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "I") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "A") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "B") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "E") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "F") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "F") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
ggsave("Plot_7.jpeg", plot = p, width = 12, height = 8, dpi = 600)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
unfaelle_clean_velostrasse_relative <- unfaelle_clean %>%
filter(on_velostrasse == TRUE) %>%
mutate(date_reference = as.Date(paste0(year, "-", month, "-01")),
ym = as.yearmon(date_reference)) %>%
left_join(average_zaehlung, by = "ym") %>%
mutate(diff = ym_accident - ym,
diff_months = round((ym_accident - ym) * 12))
unfaelle_clean_velostrasse_absolute <- unfaelle_clean_velostrasse_relative %>%
filter(diff_months >= -60 & diff_months <= 24) %>%
mutate(diff_months_group = floor(diff_months / x) * x) %>%
mutate(after_transition = diff_months_group > 0,
before_transition = diff_months_group < 0) %>%
pivot_longer(cols = c(before_transition, after_transition),
names_to = 'before_after',
values_to = "T_F") %>%
subset(T_F == TRUE) %>%
mutate(before_after = factor(before_after, levels = c("before_transition", "after_transition")))
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
ggsave("Plot_7.jpeg", plot = p, width = 12, height = 8, dpi = 600)
unfaelle_clean_velostrasse_relative <- unfaelle_clean %>%
filter(on_velostrasse == TRUE &
typ != "Parkierunfall") %>%
mutate(date_reference = as.Date(paste0(year, "-", month, "-01")),
ym = as.yearmon(date_reference)) %>%
left_join(average_zaehlung, by = "ym") %>%
mutate(diff = ym_accident - ym,
diff_months = round((ym_accident - ym) * 12))
unfaelle_clean_velostrasse_absolute <- unfaelle_clean_velostrasse_relative %>%
filter(diff_months >= -60 & diff_months <= 24) %>%
mutate(diff_months_group = floor(diff_months / x) * x) %>%
mutate(after_transition = diff_months_group > 0,
before_transition = diff_months_group < 0) %>%
pivot_longer(cols = c(before_transition, after_transition),
names_to = 'before_after',
values_to = "T_F") %>%
subset(T_F == TRUE) %>%
mutate(before_after = factor(before_after, levels = c("before_transition", "after_transition")))
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
ggsave("Plot_7.jpeg", plot = p, width = 12, height = 8, dpi = 600)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, typ) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = typ)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'typ'") +
theme_minimal()
print(p)
ggsave("Plot_7.jpeg", plot = p, width = 12, height = 8, dpi = 600)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
ggsave("Plot_8.jpeg", plot = p, width = 12, height = 8, dpi = 600)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "A") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "B") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "E") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "F") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "G") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "H") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "A") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "D") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
ggsave("Plot_8.jpeg", plot = p, width = 12, height = 8, dpi = 600)
p <- unfaelle_clean_velostrasse_absolute %>%
group_by(before_after, schwere) %>%
summarise(count = n()) %>%
ggplot(aes(before_after, count, fill = schwere)) +
geom_col(position = "fill") +
scale_fill_viridis_d(option = "C") +
ylab("Proportion of Cases") +
xlab("") +
ggtitle("Proportional Distribution of Accidents per 'schwere'") +
theme_minimal()
print(p)
ggsave("Plot_8.jpeg", plot = p, width = 12, height = 8, dpi = 600)
